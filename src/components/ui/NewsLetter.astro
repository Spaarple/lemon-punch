---

---

<div class="newsletter-modal" id="newsletterModal">
    <div class="newsletter-modal-content">
        <button class="newsletter-modal-close" id="closeNewsletterModal">&times;</button>
        <div class="newsletter-modal-header">
            <h3>Newsletter LemonPunch</h3>
            <p>Restez informés de nos nouveautés et concerts !</p>
        </div>
        <form class="newsletter-form" id="newsletterForm">
            <div class="newsletter-form-group">
                <input type="text" placeholder="Votre prénom" id="newsletterPrenom" name="prenom" required maxlength="100">
            </div>
            <div class="newsletter-form-group">
                <input type="email" placeholder="Votre email" id="newsletterEmail" name="email" required>
            </div>
            <button type="submit" class="btn-newsletter" id="newsletterSubmitBtn">
                <span class="btn-text">S'inscrire</span>
                <span class="btn-loader" style="display: none;"><i class="fas fa-spinner fa-spin"></i></span>
            </button>
            <div class="newsletter-message" id="newsletterMessage"></div>
        </form>
    </div>
</div>

<script>
    const newsletterForm = document.getElementById('newsletterForm') as HTMLFormElement;
    const newsletterSubmitBtn = document.getElementById('newsletterSubmitBtn') as HTMLButtonElement;
    const newsletterMessage = document.getElementById('newsletterMessage') as HTMLDivElement;
    const newsletterModal = document.getElementById('newsletterModal') as HTMLDivElement;

    if (newsletterForm) {
        newsletterForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const btnText = newsletterSubmitBtn.querySelector('.btn-text') as HTMLSpanElement;
            const btnLoader = newsletterSubmitBtn.querySelector('.btn-loader') as HTMLSpanElement;

            // Désactiver le bouton
            newsletterSubmitBtn.disabled = true;
            btnText.style.display = 'none';
            btnLoader.style.display = 'inline-block';
            newsletterMessage.textContent = '';
            newsletterMessage.className = 'newsletter-message';

            // Récupérer les données
            const formData = new FormData(newsletterForm);
            const data = {
                prenom: formData.get('prenom') as string,
                email: formData.get('email') as string
            };

            try {
                const response = await fetch('/api/newsletter', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    newsletterMessage.textContent = result.message;
                    newsletterMessage.classList.add('success');
                    newsletterForm.reset();

                    setTimeout(() => {
                        newsletterModal.style.display = 'none';
                        document.body.style.overflow = 'auto';
                        newsletterMessage.textContent = '';
                        newsletterMessage.className = 'newsletter-message';
                    }, 2000);
                } else {
                    newsletterMessage.textContent = result.message;
                    newsletterMessage.classList.add('error');
                }
            } catch (error) {
                console.error('Erreur:', error);
                newsletterMessage.textContent = 'Une erreur est survenue. Veuillez réessayer.';
                newsletterMessage.classList.add('error');
            } finally {
                newsletterSubmitBtn.disabled = false;
                btnText.style.display = 'inline-block';
                btnLoader.style.display = 'none';
            }
        });
    }
</script>

<style>
    .newsletter-message {
        margin-top: 1rem;
        padding: 0.75rem;
        border-radius: 4px;
        text-align: center;
        font-weight: 600;
        font-size: 0.9rem;
        display: none;
    }

    .newsletter-message.success {
        display: block;
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }

    .newsletter-message.error {
        display: block;
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }

    .btn-newsletter:disabled {
        opacity: 0.7;
        cursor: not-allowed;
    }
</style>
